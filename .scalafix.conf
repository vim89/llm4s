rules = [
  DisableSyntax
]

# Exclude infrastructure files that legitimately need try-catch-finally
# for resource management, state restoration, or exception suppression
DisableSyntax.excludePackages = [
  "org.llm4s.core.safety",           # UsingOps needs try-finally for resource management
  "org.llm4s.agent.orchestration",   # MDCContext, CancellationToken, Policies need try-catch-finally
  # (removed dbx utils; keep list lean)
  "org.llm4s.config"                  # Allow ConfigFactory only here via ConfigReader
]

DisableSyntax {
  # Syntactic regex checks; no SemanticDB required
  regex = [
    {
      id = NoConfigFactory
      pattern = "\\bConfigFactory\\b"
      message = "Use ConfigReader; do not call ConfigFactory directly."
    },
    {
      id = NoSysEnv
      pattern = "\\bsys\\.env\\b"
      message = "use ConfigReader"
    },
    {
      id = NoSystemGetenv
      pattern = "\\bSystem\\.getenv\\b"
      message = "use ConfigReader"
    },
    {
      id = NoKeywordTry
      # Forbid the try {...} keyword form; allow scala.util.Try(...)
      pattern = "(?s)\\btry\\s*\\{"
      message = "Prefer scala.util.Try(...).toResult â€” import org.llm4s.types.TryOps"
    },
    {
      id = NoKeywordCatch
      pattern = "(?s)\\bcatch\\s*\\{"
      message = "Prefer mapping Result errors instead of catch; use Try(...).toResult and .left.map/.fold"
    },
    {
      id = NoKeywordFinally
      pattern = "(?s)\\bfinally\\b"
      message = "Prefer ManagedResource/Using or ensure cleanup via dedicated combinators"
    }
  ]
}
